var U=Object.defineProperty,j=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var C=(u,a,t)=>a in u?U(u,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[a]=t,h=(u,a)=>{for(var t in a||(a={}))H.call(a,t)&&C(u,t,a[t]);if(V)for(var t of V(a))J.call(a,t)&&C(u,t,a[t]);return u},E=(u,a)=>j(u,z(a));import{d as L,a as F,J as R,o as M,b as q,j as y,c as D,W as P,n as d,f as m,w as _,h as W,i as X,g as G,bJ as K,V as Q,a_ as Y,e as A,at as Z,a0 as T,m as ee,t as te}from"./index.672c262c.js";import{E as ae,a as oe,b as ne}from"./el-select.bfa2f570.js";import{E as le,a as se,b as g}from"./el-notification.ae329e13.js";import{E as ue,a as re}from"./el-form-item.c60c539b.js";import{g as ie}from"./category.63f4076f.js";import{b as ce,u as de,c as me}from"./article.aa4686e2.js";import{l as I}from"./loading.b55613fc.js";import{_ as pe}from"./plugin-vue_export-helper.21dcd24c.js";import"./validator.e9ac4e08.js";import"./el-loading.dbcf95cb.js";const _e={id:"tinyEditor",class:"tiny-textarea"},ge={name:"Vue3Tinymce"},fe=L(E(h({},ge),{props:{modelValue:{default:""},setting:{default:()=>({})}},emits:["update:modelValue"],setup(u,{emit:a}){const t=u;let f=F();const B=o=>a("update:modelValue",o),n=()=>{const o=typeof window!="undefined"?window:global;return o&&"tinymce"in o?o.tinymce:null},p=()=>{let o=E(h({selector:"#tinyEditor"},t.setting),{images_upload_handler:x,setup:e=>{f.value=e,e.on("init",()=>w(e))}});n().init(o)},w=async o=>{await P(),o.setContent(t.modelValue),o.on("change input undo redo",e=>{k(e,o)})},k=(o,e)=>{const l=e.getContent();B(l)},x=(o,e,l)=>{let s,c,b;b=o.blob(),t.setting.custom_images_upload_header&&(s=new XMLHttpRequest,s.withCredentails=!1,s.open("POST",t.setting.images_upload_url),Object.keys(t.setting.custom_images_upload_header).forEach(r=>{s.setRequestHeader(r,t.setting.custom_images_upload_header[r])})),s.onload=()=>{let r;if(s.status!==200){l(`Http Error: ${s.status}`);return}if(r=JSON.parse(s.responseText),!r){l("Invalid JSON: "+s.responseText);return}let v=typeof t.setting.custom_images_upload_callback=="function"?t.setting.custom_images_upload_callback(r):r.location;if(!v){l("Failed Path (custom): location image path is error/empty");return}e(v)},c=new FormData,c.append("name",b.name),c.append("file",b),s.send(c)};return R(()=>t.modelValue,o=>{f.value.initialized&&f.value.setContent(o)}),M(()=>{p()}),q(()=>{n().remove()}),(o,e)=>(y(),D("div",_e))}}));const be={class:"edit-page"},ye={class:"editor-box"},ve={class:"bottom"},he={name:"ArticleEditExclude"},Ee=L(E(h({},he),{setup(u){const a=W(),t=X(),{proxy:{$lodash:f}}=G(),B={name:"",category:[],content:"",createdTime:0},n=F(f.cloneDeep(B)),p=F([]),w={height:400,toolbar:"undo redo | fullscreen | formatselect alignleft aligncenter alignright alignjustify | link unlink | numlist bullist | image media table | fontsizeselect forecolor backcolor | bold italic underline strikethrough | indent outdent | superscript subscript | removeformat |",plugins:"codesample link image table lists fullscreen",toolbar_mode:"sliding",nonbreaking_force_tab:!0,link_title:!1,default_link_target:"_blank",content_style:`
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background-color: hsl(0deg 0% 42% / 20%);
      border-radius: 10px;
      transition: all .2s ease-in-out;
    }
    ::-webkit-scrollbar-track {
      border-radius: 10px;
    }
    body {
      font-size: 16px 
    }
  `,placeholder:"\u8BF7\u8F93\u5165\u6587\u7AE0\u5185\u5BB9!",custom_images_upload:!0,custom_images_upload_header:d().getToken,images_upload_url:`${d().uploadPath}/articles`,custom_images_upload_callback:e=>e.url,language:"zh_CN",branding:!1},k=async()=>{let e=await ie(),l=e.data.findIndex(s=>s.name==="\u65B0\u95FB\u8D44\u8BAF");p.value.push(e.data[l].children),l=e.data.findIndex(s=>s.name==="\u8D5B\u4E8B\u4E2D\u5FC3"),p.value.push(e.data[l].children),p.value=p.value.flat()},x=async()=>{try{if(a.params.id){const e=await ce(a.params.id);e.status===200&&(n.value.category=e.data.category,n.value.name=e.data.name,n.value.content=e.data.content)}}catch(e){console.log(e),g({duration:d().tipDurationS,title:"Error",message:"\u83B7\u53D6\u6587\u7AE0\u6570\u636E\u5931\u8D25\u4E86!",type:"error"})}},o=async()=>{var e;if(!n.value.category.length){g({duration:d().tipDurationM,type:"warning",message:"\u8BF7\u9009\u62E9\u5206\u7C7B!"});return}if(!n.value.name.trim().length){g({duration:d().tipDurationM,type:"warning",message:"\u8BF7\u8F93\u5165\u6807\u9898!"});return}if(!n.value.content.trim().length){g({duration:d().tipDurationM,type:"warning",message:"\u8BF7\u8F93\u5165\u6587\u7AE0\u5185\u5BB9!"});return}n.value.createdTime=Date.now(),a.params.id?(await de((e=a.params)==null?void 0:e.id,n.value)).status===200&&g({duration:d().tipDurationM,type:"success",message:"\u66F4\u65B0\u6210\u529F!"}):(await me(n.value)).status===200&&g({duration:d().tipDurationM,type:"success",message:"\u6587\u7AE0\u6DFB\u52A0\u6210\u529F!"}),t.push({name:"articleList",query:{reload:"true"}})};return M(async()=>{try{I.openLoading(),await k(),await x()}catch(e){console.log(e)}finally{I.closeLoading()}}),(e,l)=>{const s=le,c=ue,b=ae,r=oe,v=fe,S=re,N=se,$=ne,O=K("permission");return y(),D("div",be,[m($,null,{default:_(()=>[m(S,{"label-position":"top"},{default:_(()=>[m(c,{label:"\u6587\u7AE0\u6807\u9898:"},{default:_(()=>[m(s,{clearable:"",modelValue:n.value.name,"onUpdate:modelValue":l[0]||(l[0]=i=>n.value.name=i),placeholder:"\u8BF7\u8F93\u5165\u6587\u7AE0\u6807\u9898!"},null,8,["modelValue"])]),_:1}),m(c,{label:"\u6587\u7AE0\u5206\u7C7B:"},{default:_(()=>[m(r,{class:"cate-select",modelValue:n.value.category,"onUpdate:modelValue":l[1]||(l[1]=i=>n.value.category=i),multiple:"",clearable:"",placeholder:"\u9009\u62E9\u5206\u7C7B"},{default:_(()=>[(y(!0),D(Q,null,Y(p.value,i=>(y(),T(b,{key:i._id,label:i.name,value:i._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),m(c,{label:"\u6587\u7AE0\u5185\u5BB9:"},{default:_(()=>[A("div",ye,[m(v,{modelValue:n.value.content,"onUpdate:modelValue":l[2]||(l[2]=i=>n.value.content=i),setting:w},null,8,["modelValue"])])]),_:1})]),_:1}),A("div",ve,[Z((y(),T(N,{class:"save-btn",type:"primary",plain:"",onClick:o},{default:_(()=>[ee(te(e.$t("btn.save")),1)]),_:1})),[[O,["admin"]]])])]),_:1})])}}}));var Le=pe(Ee,[["__scopeId","data-v-08304d8a"]]);export{Le as default};
