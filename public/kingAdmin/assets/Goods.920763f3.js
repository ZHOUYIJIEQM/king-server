import{d as ce,a as p,r as pe,G as me,o as _e,aE as ve,a0 as G,w as o,u as m,ac as fe,n as _,W as M,bJ as ge,j as i,f as a,aj as P,e as c,t as f,c as r,V,a_ as T,a3 as x,m as b,bK as be,a1 as ye,bk as Ee,bL as Ce,bM as R,a$ as he,b0 as we,g as Fe,bN as O}from"./index.3ca1645a.js";import{v as Be}from"./el-loading.274a2446.js";import{_ as De}from"./TableCard.cbf3a947.js";import{E as Se,a as ke}from"./el-form-item.db66e866.js";/* empty css                */import{E as $e}from"./el-rate.1ecbb10d.js";import{_ as Ae}from"./UploadFile.8cb5d594.js";import{E as Ve,a as g}from"./el-notification.56fc006a.js";import{E as Te,a as xe}from"./el-table-column.bd304a43.js";import"./el-tag.c1c1dc80.js";import"./el-tooltip.586473e3.js";import{E as Ue}from"./el-scrollbar.5cf2b49c.js";import{E as Ie}from"./el-image-viewer.c72e95dc.js";import{E as Ne}from"./el-message-box.7c334b5f.js";import"./el-overlay.1588578f.js";import{g as Ge,a as q,c as je,u as ze,d as He}from"./goods.6331583d.js";import{e as Le}from"./excel.f80f3bce.js";import{_ as Me}from"./plugin-vue_export-helper.21dcd24c.js";import"./_arrayPush.ab7ef295.js";import"./el-select.8fb73295.js";import"./validator.6fdf4b3e.js";import"./debounce.eb328bbe.js";import"./refs.293d8cc3.js";import"./browser.bcd0aa3c.js";const j=B=>(he("data-v-6aa3e392"),B=B(),we(),B),Pe=b("\u5BFC\u51FAExcel"),Re={class:"expand"},Oe={class:"goods-name"},qe=j(()=>c("span",{class:"title"},"\u540D\u79F0:",-1)),Je={key:0,class:"desc-box"},Ke=j(()=>c("span",{class:"title"},"\u5C5E\u6027:",-1)),We={key:0},Qe={key:1,class:"passive-box"},Xe={class:"passive-title"},Ye={key:0},Ze={class:"price-box"},ea=j(()=>c("span",{class:"title"},"\u603B\u4EF7:",-1)),aa={class:"option"},ta=b(" \u65B0\u589E\u5C5E\u6027"),la=b(" \u65B0\u589E\u88AB\u52A8"),oa=ce({setup(B){const D=p(),{proxy:U}=Fe(),{$lodash:J}=U,C=p(!1),h=p(!1),z=p([]),w=p(!1),S=pe({pageNum:1,pageSize:10}),I=p(0);let v={pageNum:1,pageSize:10,sortItem:"price",orderType:"ascending"};const s=p({}),k=p(""),K=me(()=>`${_().uploadPath}/items`),N=p(!1),W=e=>{k.value=e,s.value.icon=e},Q=async e=>{h.value=!1,C.value=!0,k.value=e.icon,s.value=J.cloneDeep(e),await M(),setTimeout(()=>{U.$refs.nameEl.focus()},200)},X=async e=>{Ne.confirm("\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u88C5\u5907\u5417?","\u5220\u9664\u88C5\u5907",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async t=>{const u=await He(e._id);u.status===200?(g({duration:_().tipDurationS,type:"success",message:`${e.name} ${u.data.message}`}),await F(v)):g({duration:_().tipDurationS,type:"error",message:u.data.message})}).catch(t=>{console.log(t)})},F=async e=>{try{w.value=!0;let t={};e!=null&&e.name?t=await Ge(e):t=await q(e),z.value=t==null?void 0:t.data.data,I.value=t==null?void 0:t.data.total}catch(t){g({duration:_().tipDurationS,type:"error",message:t.message})}finally{setTimeout(()=>{w.value=!1},300)}},Y=async e=>{v=Object.assign({},v,e),await F(v)},Z=async e=>{h.value=!0,C.value=!0,k.value="",s.value={passive:[""],desc:[""]},await M(),D.value.dialogScrollbarEl.scrollTo({top:0}),setTimeout(()=>{U.$refs.nameEl.focus()},100)},H=(e,t)=>{e.length>1?e.splice(t,1):g({duration:_().tipDurationS,type:"warning",message:"\u81F3\u5C11\u9700\u6709\u4E00\u4E2A!"})},L=async e=>{e.push(""),setTimeout(()=>{D.value.dialogScrollbarEl.scrollTo({top:D.value.dialogScrollbarEl.wrap$.scrollTop+50,behavior:"smooth"})},100)},ee=async()=>{try{w.value=!0;let e={};h.value?e=await je(s.value):e=await ze(s.value._id,s.value),e.status===200&&g({duration:_().tipDurationS,type:"success",message:e.data.message}),C.value=!1,await F(v)}catch(e){console.log(e),g({duration:_().tipDurationS,type:"success",message:e.message})}finally{w.value=!1}},ae=async()=>{try{N.value=!0;const e=await q({pageNum:1,pageSize:I.value});console.log("\u5BFC\u51FA",e.data.data);let t=e.data.data.map(u=>(delete u._id,delete u.__v,u.desc=u.desc.join("\u3002"),u.passive=u.passive.join("\u3002"),u));Le(e.data.data,"\u8868\u683C1","\u88C5\u5907.xlsx"),g({duration:_().tipDurationS,type:"success",message:"\u5BFC\u51FA\u5B8C\u6210!"})}catch(e){console.log(e),g({duration:_().tipDurationS,type:"error",message:"\u5BFC\u51FA\u5931\u8D25!"})}finally{N.value=!1}},te=async e=>{v.orderType=e.order,await F(v)};return _e(async()=>{await F(v)}),(e,t)=>{const u=Ue,y=Te,le=Ie,oe=xe,$=Ve,E=Se,se=Ae,ue=$e,A=ve,ne=ke,ie=De,re=ge("permission"),de=Be;return i(),G(ie,{ref_key:"TableCardEl",ref:D,showSearch:"",pagination:m(S),"onUpdate:pagination":t[5]||(t[5]=l=>fe(S)?S.value=l:S=l),visible:C.value,"onUpdate:visible":t[6]||(t[6]=l=>C.value=l),isAdd:h.value,totalNum:I.value,btnAdd:e.$t("btn.addGoods"),dialogTitle:h.value?e.$t("btn.addGoods"):e.$t("btn.editGoods"),onReloadData:Y,onAddDataItem:Z,onSaveContent:ee},{otherBtn:o(()=>[a(u,{loading:N.value,type:"primary",plain:"",onClick:ae},{default:o(()=>[Pe]),_:1},8,["loading"])]),table:o(()=>[P((i(),G(oe,{class:"table",border:"","empty-text":"\u6682\u65E0\u88C5\u5907!",data:z.value,"default-sort":{prop:"price",order:"ascending"},onSortChange:te},{default:o(()=>[a(y,{"class-name":"expand",type:"expand",label:e.$t("tableH.expand"),width:"85"},{default:o(l=>[c("div",Re,[c("div",Oe,[qe,c("span",null,f(l.row.name),1)]),l.row.desc?(i(),r("div",Je,[Ke,(i(!0),r(V,null,T(l.row.desc,(n,d)=>(i(),r("span",{class:"desc-item",key:d},[b(f(n)+" ",1),d<l.row.desc.length-1?(i(),r("span",We,"\u3001")):x("",!0)]))),128))])):x("",!0),l.row.passive.length?(i(),r("div",Qe,[(i(!0),r(V,null,T(l.row.passive,(n,d)=>(i(),r("p",{class:"passive-item",key:d},[c("span",Xe,[b(f(n.split("\uFF1A").at(0)),1),n.split("\uFF1A").length>1?(i(),r("span",Ye,"\uFF1A")):x("",!0)]),c("span",null,f(n.split("\uFF1A").slice(1).join("")),1)]))),128))])):x("",!0),c("div",Ze,[ea,b(" "+f(l.row.price)+" \u91D1\u5E01",1)])])]),_:1},8,["label"]),a(y,{align:"center",type:"index",label:e.$t("tableH.orderNum"),width:"70"},null,8,["label"]),a(y,{label:e.$t("tableH.name"),prop:"name"},null,8,["label"]),a(y,{"class-name":"goods-img-box",label:e.$t("tableH.appearance")},{default:o(l=>[a(le,{lazy:"",class:"goods-img",src:l.row.icon},null,8,["src"])]),_:1},8,["label"]),a(y,{sortable:"custom",label:e.$t("tableH.price"),prop:"price"},null,8,["label"]),a(y,{label:e.$t("tableH.operation"),align:"center",width:"200"},{default:o(l=>[c("div",aa,[a(u,{size:"small",type:"primary",plain:"",icon:m(be),onClick:n=>Q(l.row)},{default:o(()=>[b(f(e.$t("btn.edit"))+" / "+f(e.$t("btn.view")),1)]),_:2},1032,["icon","onClick"]),P((i(),G(u,{style:ye({"margin-top":m(Ee)().valueHasPermission(["admin"])?"10px":""}),size:"small",type:"danger",plain:"",icon:m(Ce),onClick:n=>X(l.row)},{default:o(()=>[b(f(e.$t("btn.delete")),1)]),_:2},1032,["style","icon","onClick"])),[[re,["admin"]]])])]),_:1},8,["label"])]),_:1},8,["data"])),[[de,w.value]])]),dialog:o(()=>[a(ne,{class:"dialog-from",model:s.value,"label-width":"80px","label-position":"left"},{default:o(()=>[a(E,{label:"\u88C5\u5907\u540D\u79F0"},{default:o(()=>[a($,{clearable:"",ref:"nameEl",modelValue:s.value.name,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.name=l),placeholder:"\u8BF7\u8F93\u5165\u88C5\u5907\u540D!"},null,8,["modelValue"])]),_:1}),a(E,{label:"\u88C5\u5907\u56FE\u6807"},{default:o(()=>[a(se,{class:"hero-avatar",actionUrl:m(K),imageUrl:k.value,onUploadSuccess:W},null,8,["actionUrl","imageUrl"])]),_:1}),a(E,{label:"\u8BC4\u7EA7"},{default:o(()=>[a(ue,{class:"rate",max:3,modelValue:s.value.star,"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.star=l)},null,8,["modelValue"])]),_:1}),a(E,{label:"\u4EF7\u683C",class:"property-box"},{default:o(()=>[a($,{clearable:"",class:"input-item",modelValue:s.value.price,"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.price=l),placeholder:"\u8BF7\u8F93\u5165\u4EF7\u683C!"},null,8,["modelValue"])]),_:1}),a(E,{label:"\u88C5\u5907\u5C5E\u6027",class:"property-box"},{default:o(()=>[(i(!0),r(V,null,T(s.value.desc,(l,n)=>(i(),r("div",{class:"property-item",ref_for:!0,ref:"descItem",key:n},[a($,{class:"input-item",modelValue:s.value.desc[n],"onUpdate:modelValue":d=>s.value.desc[n]=d,placeholder:"\u8BF7\u8F93\u5165\u5C5E\u6027!"},{suffix:o(()=>[a(A,{onClick:d=>H(s.value.desc,n)},{default:o(()=>[a(m(O))]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),a(u,{class:"add-new-button",type:"primary",plain:"",onClick:t[3]||(t[3]=l=>L(s.value.desc))},{default:o(()=>[ta,a(A,{class:"el-icon--right"},{default:o(()=>[a(m(R))]),_:1})]),_:1})]),_:1}),a(E,{label:"\u88C5\u5907\u88AB\u52A8",class:"property-box"},{default:o(()=>[(i(!0),r(V,null,T(s.value.passive,(l,n)=>(i(),r("div",{class:"property-item",ref_for:!0,ref:"passiveItem",key:n},[a($,{class:"input-item",modelValue:s.value.passive[n],"onUpdate:modelValue":d=>s.value.passive[n]=d,placeholder:"\u8BF7\u8F93\u5165\u88AB\u52A8!"},{suffix:o(()=>[a(A,{onClick:d=>H(s.value.passive,n)},{default:o(()=>[a(m(O))]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),a(u,{class:"add-new-button",type:"primary",plain:"",onClick:t[4]||(t[4]=l=>L(s.value.passive))},{default:o(()=>[la,a(A,{class:"el-icon--right"},{default:o(()=>[a(m(R))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["pagination","visible","isAdd","totalNum","btnAdd","dialogTitle"])}}});var $a=Me(oa,[["__scopeId","data-v-6aa3e392"]]);export{$a as default};
