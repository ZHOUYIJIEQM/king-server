import{d as ie,a as _,r as re,G as de,o as ce,av as pe,a0 as N,w as s,u as p,ad as me,n as f,W as j,bJ as _e,j as u,at as M,f as a,e as c,t as v,c as i,V as T,a_ as A,a3 as U,m as b,bK as ve,a1 as fe,bk as be,bL as ge,bM as P,a$ as ye,b0 as Ee,g as Ce,bN as R}from"./index.672c262c.js";import{v as we}from"./el-loading.dbcf95cb.js";import{E as he,a as Fe,_ as De}from"./el-table-column.7a12c849.js";import{E as $e,a as ke}from"./el-form-item.c60c539b.js";/* empty css                */import{E as Be}from"./el-rate.d463f83d.js";import{_ as Se}from"./UploadFile.d0bdbc92.js";import{a as Ve,E as Te,b as y}from"./el-notification.ae329e13.js";import"./el-select.bfa2f570.js";import"./el-tooltip.586473e3.js";import{E as Ae}from"./el-image-viewer.511dce7d.js";import{E as Ue}from"./el-message-box.6e55e049.js";import"./el-overlay.1f147f42.js";import{g as Ie,a as Ne,c as Ge,u as xe,d as He}from"./goods.2e3228f2.js";import{_ as ze}from"./plugin-vue_export-helper.21dcd24c.js";import"./validator.e9ac4e08.js";import"./refs.a8fe6481.js";import"./browser.b5f45099.js";const G=F=>(ye("data-v-623f4d65"),F=F(),Ee(),F),Le={class:"expand"},je={class:"goods-name"},Me=G(()=>c("span",{class:"title"},"\u540D\u79F0:",-1)),Pe={key:0,class:"desc-box"},Re=G(()=>c("span",{class:"title"},"\u5C5E\u6027:",-1)),Oe={key:0},qe={key:1,class:"passive-box"},Je={class:"passive-title"},Ke={key:0},We={class:"price-box"},Qe=G(()=>c("span",{class:"title"},"\u603B\u4EF7:",-1)),Xe={class:"option"},Ye=b(" \u65B0\u589E\u5C5E\u6027"),Ze=b(" \u65B0\u589E\u88AB\u52A8"),ea=ie({setup(F){const D=_(),{proxy:I}=Ce(),{$lodash:O}=I,E=_(!1),C=_(!1),x=_([]),w=_(!1),$=re({pageNum:1,pageSize:10}),H=_(0);let m={pageNum:1,pageSize:10,sortItem:"price",orderType:"ascending"};const o=_({}),k=_(""),q=de(()=>`${f().uploadPath}/items`),J=e=>{k.value=e,o.value.icon=e},K=async e=>{C.value=!1,E.value=!0,k.value=e.icon,o.value=O.cloneDeep(e),await j(),setTimeout(()=>{I.$refs.nameEl.focus()},200)},W=async e=>{Ue.confirm("\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u88C5\u5907\u5417?","\u5220\u9664\u88C5\u5907",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async t=>{const r=await He(e._id);r.status===200?(y({duration:f().tipDurationS,type:"success",message:`${e.name} ${r.data.message}`}),await h(m)):y({duration:f().tipDurationS,type:"error",message:r.data.message})}).catch(t=>{console.log(t)})},h=async e=>{try{w.value=!0;let t={};e!=null&&e.name?t=await Ie(e):t=await Ne(e),x.value=t==null?void 0:t.data.data,H.value=t==null?void 0:t.data.total}catch(t){y({duration:f().tipDurationS,type:"error",message:t.message})}finally{setTimeout(()=>{w.value=!1},300)}},Q=async e=>{m=Object.assign({},m,e),await h(m)},X=async e=>{C.value=!0,E.value=!0,k.value="",o.value={passive:[""],desc:[""]},await j(),D.value.dialogScrollbarEl.scrollTo({top:0}),setTimeout(()=>{I.$refs.nameEl.focus()},100)},z=(e,t)=>{e.length>1?e.splice(t,1):y({duration:f().tipDurationS,type:"warning",message:"\u81F3\u5C11\u9700\u6709\u4E00\u4E2A!"})},L=async e=>{e.push(""),setTimeout(()=>{D.value.dialogScrollbarEl.scrollTo({top:D.value.dialogScrollbarEl.wrap$.scrollTop+50,behavior:"smooth"})},100)},Y=async()=>{try{w.value=!0;let e={};C.value?e=await Ge(o.value):e=await xe(o.value._id,o.value),e.status===200&&y({duration:f().tipDurationS,type:"success",message:e.data.message}),E.value=!1,await h(m)}catch(e){console.log(e),y({duration:f().tipDurationS,type:"success",message:e.message})}finally{w.value=!1}},Z=async e=>{m.orderType=e.order,await h(m)};return ce(async()=>{await h(m)}),(e,t)=>{const r=he,ee=Ae,B=Ve,ae=Fe,S=Te,g=$e,te=Se,le=Be,V=pe,oe=ke,se=De,ne=_e("permission"),ue=we;return u(),N(se,{ref_key:"TableCardEl",ref:D,showSearch:"",pagination:p($),"onUpdate:pagination":t[5]||(t[5]=l=>me($)?$.value=l:$=l),visible:E.value,"onUpdate:visible":t[6]||(t[6]=l=>E.value=l),isAdd:C.value,totalNum:H.value,btnAdd:e.$t("btn.addGoods"),dialogTitle:C.value?e.$t("btn.addGoods"):e.$t("btn.editGoods"),onReloadData:Q,onAddDataItem:X,onSaveContent:Y},{table:s(()=>[M((u(),N(ae,{class:"table",border:"","empty-text":"\u6682\u65E0\u88C5\u5907!",data:x.value,"default-sort":{prop:"price",order:"ascending"},onSortChange:Z},{default:s(()=>[a(r,{"class-name":"expand",type:"expand",label:e.$t("tableH.expand"),width:"85"},{default:s(l=>[c("div",Le,[c("div",je,[Me,c("span",null,v(l.row.name),1)]),l.row.desc?(u(),i("div",Pe,[Re,(u(!0),i(T,null,A(l.row.desc,(n,d)=>(u(),i("span",{class:"desc-item",key:d},[b(v(n)+" ",1),d<l.row.desc.length-1?(u(),i("span",Oe,"\u3001")):U("",!0)]))),128))])):U("",!0),l.row.passive.length?(u(),i("div",qe,[(u(!0),i(T,null,A(l.row.passive,(n,d)=>(u(),i("p",{class:"passive-item",key:d},[c("span",Je,[b(v(n.split("\uFF1A").at(0)),1),n.split("\uFF1A").length>1?(u(),i("span",Ke,"\uFF1A")):U("",!0)]),c("span",null,v(n.split("\uFF1A").slice(1).join("")),1)]))),128))])):U("",!0),c("div",We,[Qe,b(" "+v(l.row.price)+" \u91D1\u5E01",1)])])]),_:1},8,["label"]),a(r,{align:"center",type:"index",label:e.$t("tableH.orderNum"),width:"70"},null,8,["label"]),a(r,{label:e.$t("tableH.name"),prop:"name"},null,8,["label"]),a(r,{"class-name":"goods-img-box",label:e.$t("tableH.appearance")},{default:s(l=>[a(ee,{lazy:"",class:"goods-img",src:l.row.icon},null,8,["src"])]),_:1},8,["label"]),a(r,{sortable:"custom",label:e.$t("tableH.price"),prop:"price"},null,8,["label"]),a(r,{label:e.$t("tableH.operation"),align:"center",width:"200"},{default:s(l=>[c("div",Xe,[a(B,{size:"small",type:"primary",plain:"",icon:p(ve),onClick:n=>K(l.row)},{default:s(()=>[b(v(e.$t("btn.edit"))+" / "+v(e.$t("btn.view")),1)]),_:2},1032,["icon","onClick"]),M((u(),N(B,{style:fe({"margin-top":p(be)().valueHasPermission(["admin"])?"10px":""}),size:"small",type:"danger",plain:"",icon:p(ge),onClick:n=>W(l.row)},{default:s(()=>[b(v(e.$t("btn.delete")),1)]),_:2},1032,["style","icon","onClick"])),[[ne,["admin"]]])])]),_:1},8,["label"])]),_:1},8,["data"])),[[ue,w.value]])]),dialog:s(()=>[a(oe,{class:"dialog-from",model:o.value,"label-width":"80px","label-position":"left"},{default:s(()=>[a(g,{label:"\u88C5\u5907\u540D\u79F0"},{default:s(()=>[a(S,{clearable:"",ref:"nameEl",modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.name=l),placeholder:"\u8BF7\u8F93\u5165\u88C5\u5907\u540D!"},null,8,["modelValue"])]),_:1}),a(g,{label:"\u88C5\u5907\u56FE\u6807"},{default:s(()=>[a(te,{class:"hero-avatar",actionUrl:p(q),imageUrl:k.value,onUploadSuccess:J},null,8,["actionUrl","imageUrl"])]),_:1}),a(g,{label:"\u8BC4\u7EA7"},{default:s(()=>[a(le,{class:"rate",max:3,modelValue:o.value.star,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.star=l)},null,8,["modelValue"])]),_:1}),a(g,{label:"\u4EF7\u683C",class:"property-box"},{default:s(()=>[a(S,{clearable:"",class:"input-item",modelValue:o.value.price,"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.price=l),placeholder:"\u8BF7\u8F93\u5165\u4EF7\u683C!"},null,8,["modelValue"])]),_:1}),a(g,{label:"\u88C5\u5907\u5C5E\u6027",class:"property-box"},{default:s(()=>[(u(!0),i(T,null,A(o.value.desc,(l,n)=>(u(),i("div",{class:"property-item",ref_for:!0,ref:"descItem",key:n},[a(S,{class:"input-item",modelValue:o.value.desc[n],"onUpdate:modelValue":d=>o.value.desc[n]=d,placeholder:"\u8BF7\u8F93\u5165\u5C5E\u6027!"},{suffix:s(()=>[a(V,{onClick:d=>z(o.value.desc,n)},{default:s(()=>[a(p(R))]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),a(B,{class:"add-new-button",type:"primary",plain:"",onClick:t[3]||(t[3]=l=>L(o.value.desc))},{default:s(()=>[Ye,a(V,{class:"el-icon--right"},{default:s(()=>[a(p(P))]),_:1})]),_:1})]),_:1}),a(g,{label:"\u88C5\u5907\u88AB\u52A8",class:"property-box"},{default:s(()=>[(u(!0),i(T,null,A(o.value.passive,(l,n)=>(u(),i("div",{class:"property-item",ref_for:!0,ref:"passiveItem",key:n},[a(S,{class:"input-item",modelValue:o.value.passive[n],"onUpdate:modelValue":d=>o.value.passive[n]=d,placeholder:"\u8BF7\u8F93\u5165\u88AB\u52A8!"},{suffix:s(()=>[a(V,{onClick:d=>z(o.value.passive,n)},{default:s(()=>[a(p(R))]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),a(B,{class:"add-new-button",type:"primary",plain:"",onClick:t[4]||(t[4]=l=>L(o.value.passive))},{default:s(()=>[Ze,a(V,{class:"el-icon--right"},{default:s(()=>[a(p(P))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["pagination","visible","isAdd","totalNum","btnAdd","dialogTitle"])}}});var ya=ze(ea,[["__scopeId","data-v-623f4d65"]]);export{ya as default};
