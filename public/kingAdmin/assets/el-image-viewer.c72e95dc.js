var Ee=Object.defineProperty,Le=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var me=(l,o,n)=>o in l?Ee(l,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[o]=n,X=(l,o)=>{for(var n in o||(o={}))ze.call(o,n)&&me(l,n,o[n]);if(ve)for(var n of ve(o))Oe.call(o,n)&&me(l,n,o[n]);return l},Q=(l,o)=>Le(l,Ce(o));import{q as xe,ae as R,A as ge,B as re,aG as we,al as fe,d as te,bq as pe,br as Se,bs as Ne,I as ye,au as Te,a as h,bt as Ae,aI as $e,G as k,J as ie,W as be,o as he,j as I,a0 as ue,f,w as L,e as m,O as v,u as e,aN as Be,a3 as _,aE as x,bu as Re,c as S,bv as Ve,bh as Me,V as ce,bw as De,bx as Ye,a2 as Fe,by as He,bz as Xe,a_ as Pe,aj as je,ak as We,a1 as de,N as ee,a4 as qe,av as Ge,_ as ke,ai as V,ag as B,bA as Ze,a5 as Ie,aH as Je,at as Ke,as as Ue,E as Qe,t as et,bB as tt}from"./index.3ca1645a.js";import{i as at}from"./browser.bcd0aa3c.js";import{j as _e}from"./el-scrollbar.5cf2b49c.js";import{d as nt}from"./debounce.eb328bbe.js";import{u as st}from"./el-notification.56fc006a.js";import{g as lt}from"./validator.6fdf4b3e.js";var ot="Expected a function";function oe(l,o,n){var r=!0,p=!0;if(typeof l!="function")throw new TypeError(ot);return xe(n)&&(r="leading"in n?!!n.leading:r,p="trailing"in n?!!n.trailing:p),nt(l,o,{leading:r,maxWait:o,trailing:p})}const rt=(l,o)=>{if(!R||!l||!o)return!1;const n=l.getBoundingClientRect();let r;return o instanceof Element?r=o.getBoundingClientRect():r={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},n.top<r.bottom&&n.bottom>r.top&&n.right>r.left&&n.left<r.right},it=ge({urlList:{type:re(Array),default:()=>we([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0}}),ut={close:()=>!0,switch:l=>fe(l)},ct=["src"],dt=te({name:"ElImageViewer"}),ft=te(Q(X({},dt),{props:it,emits:ut,setup(l,{expose:o,emit:n}){const r=l,p={CONTAIN:{name:"contain",icon:pe(Se)},ORIGINAL:{name:"original",icon:pe(Ne)}},C=at()?"DOMMouseScroll":"mousewheel",{t:ae}=_e(),u=ye("image-viewer"),{nextZIndex:M}=Te(),g=h(),E=h([]),T=Ae(),w=h(!0),d=h(r.initialIndex),A=$e(p.CONTAIN),c=h({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),D=k(()=>{const{urlList:t}=r;return t.length<=1}),P=k(()=>d.value===0),j=k(()=>d.value===r.urlList.length-1),Y=k(()=>r.urlList[d.value]),ne=k(()=>{const{scale:t,deg:s,offsetX:i,offsetY:y,enableTransition:z}=c.value;let b=i/t,O=y/t;switch(s%360){case 90:case-270:[b,O]=[O,-b];break;case 180:case-180:[b,O]=[-b,-O];break;case 270:case-90:[b,O]=[-O,b];break}const $={transform:`scale(${t}) rotate(${s}deg) translate(${b}px, ${O}px)`,transition:z?"transform .3s":""};return A.value.name===p.CONTAIN.name&&($.maxWidth=$.maxHeight="100%"),$}),W=k(()=>fe(r.zIndex)?r.zIndex:M());function N(){le(),n("close")}function se(){const t=oe(i=>{switch(i.code){case B.esc:r.closeOnPressEscape&&N();break;case B.space:J();break;case B.left:K();break;case B.up:a("zoomIn");break;case B.right:U();break;case B.down:a("zoomOut");break}}),s=oe(i=>{(i.wheelDelta?i.wheelDelta:-i.detail)>0?a("zoomIn",{zoomRate:1.2,enableTransition:!1}):a("zoomOut",{zoomRate:1.2,enableTransition:!1})});T.run(()=>{V(document,"keydown",t),V(document,C,s)})}function le(){T.stop()}function q(){w.value=!1}function G(t){w.value=!1,t.target.alt=ae("el.image.error")}function Z(t){if(w.value||t.button!==0||!g.value)return;c.value.enableTransition=!1;const{offsetX:s,offsetY:i}=c.value,y=t.pageX,z=t.pageY,b=oe($=>{c.value=Q(X({},c.value),{offsetX:s+$.pageX-y,offsetY:i+$.pageY-z})}),O=V(document,"mousemove",b);V(document,"mouseup",()=>{O()}),t.preventDefault()}function F(){c.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function J(){if(w.value)return;const t=Ze(p),s=Object.values(p),i=A.value.name,z=(s.findIndex(b=>b.name===i)+1)%t.length;A.value=p[t[z]],F()}function H(t){const s=r.urlList.length;d.value=(t+s)%s}function K(){P.value&&!r.infinite||H(d.value-1)}function U(){j.value&&!r.infinite||H(d.value+1)}function a(t,s={}){if(w.value)return;const{zoomRate:i,rotateDeg:y,enableTransition:z}=X({zoomRate:1.4,rotateDeg:90,enableTransition:!0},s);switch(t){case"zoomOut":c.value.scale>.2&&(c.value.scale=Number.parseFloat((c.value.scale/i).toFixed(3)));break;case"zoomIn":c.value.scale<7&&(c.value.scale=Number.parseFloat((c.value.scale*i).toFixed(3)));break;case"clockwise":c.value.deg+=y;break;case"anticlockwise":c.value.deg-=y;break}c.value.enableTransition=z}return ie(Y,()=>{be(()=>{const t=E.value[0];t!=null&&t.complete||(w.value=!0)})}),ie(d,t=>{F(),n("switch",t)}),he(()=>{var t,s;se(),(s=(t=g.value)==null?void 0:t.focus)==null||s.call(t)}),o({setActiveItem:H}),(t,s)=>(I(),ue(Ge,{to:"body",disabled:!t.teleported},[f(qe,{name:"viewer-fade",appear:""},{default:L(()=>[m("div",{ref_key:"wrapper",ref:g,tabindex:-1,class:v(e(u).e("wrapper")),style:de({zIndex:e(W)})},[m("div",{class:v(e(u).e("mask")),onClick:s[0]||(s[0]=Be(i=>t.hideOnClickModal&&N(),["self"]))},null,2),_(" CLOSE "),m("span",{class:v([e(u).e("btn"),e(u).e("close")]),onClick:N},[f(e(x),null,{default:L(()=>[f(e(Re))]),_:1})],2),_(" ARROW "),e(D)?_("v-if",!0):(I(),S(ce,{key:0},[m("span",{class:v([e(u).e("btn"),e(u).e("prev"),e(u).is("disabled",!t.infinite&&e(P))]),onClick:K},[f(e(x),null,{default:L(()=>[f(e(Ve))]),_:1})],2),m("span",{class:v([e(u).e("btn"),e(u).e("next"),e(u).is("disabled",!t.infinite&&e(j))]),onClick:U},[f(e(x),null,{default:L(()=>[f(e(Me))]),_:1})],2)],64)),_(" ACTIONS "),m("div",{class:v([e(u).e("btn"),e(u).e("actions")])},[m("div",{class:v(e(u).e("actions__inner"))},[f(e(x),{onClick:s[1]||(s[1]=i=>a("zoomOut"))},{default:L(()=>[f(e(De))]),_:1}),f(e(x),{onClick:s[2]||(s[2]=i=>a("zoomIn"))},{default:L(()=>[f(e(Ye))]),_:1}),m("i",{class:v(e(u).e("actions__divider"))},null,2),f(e(x),{onClick:J},{default:L(()=>[(I(),ue(Fe(e(A).icon)))]),_:1}),m("i",{class:v(e(u).e("actions__divider"))},null,2),f(e(x),{onClick:s[3]||(s[3]=i=>a("anticlockwise"))},{default:L(()=>[f(e(He))]),_:1}),f(e(x),{onClick:s[4]||(s[4]=i=>a("clockwise"))},{default:L(()=>[f(e(Xe))]),_:1})],2)],2),_(" CANVAS "),m("div",{class:v(e(u).e("canvas"))},[(I(!0),S(ce,null,Pe(t.urlList,(i,y)=>je((I(),S("img",{ref_for:!0,ref:z=>E.value[y]=z,key:i,src:i,style:de(e(ne)),class:v(e(u).e("img")),onLoad:q,onError:G,onMousedown:Z},null,46,ct)),[[We,y===d.value]])),128))],2),ee(t.$slots,"default")],6)]),_:3})],8,["disabled"]))}}));var vt=ke(ft,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const mt=Ie(vt),pt=ge({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:re([String,Object])},previewSrcList:{type:re(Array),default:()=>we([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0}}),gt={load:l=>l instanceof Event,error:l=>l instanceof Event,switch:l=>fe(l),close:()=>!0,show:()=>!0},wt=["src","loading"],yt={key:0},bt=te({name:"ElImage",inheritAttrs:!1}),ht=te(Q(X({},bt),{props:pt,emits:gt,setup(l,{emit:o}){const n=l;let r="";const{t:p}=_e(),C=ye("image"),ae=Je(),u=st(),M=h(),g=h(!1),E=h(!0),T=h(!1),w=h(),d=h(),A=R&&"loading"in HTMLImageElement.prototype;let c,D;const P=k(()=>ae.style),j=k(()=>{const{fit:a}=n;return R&&a?{objectFit:a}:{}}),Y=k(()=>{const{previewSrcList:a}=n;return Array.isArray(a)&&a.length>0}),ne=k(()=>{const{previewSrcList:a,initialIndex:t}=n;let s=t;return t>a.length-1&&(s=0),s}),W=k(()=>n.loading==="eager"?!1:!A&&n.loading==="lazy"||n.lazy),N=()=>{!R||(E.value=!0,g.value=!1,M.value=n.src)};function se(a){E.value=!1,g.value=!1,o("load",a)}function le(a){E.value=!1,g.value=!0,o("error",a)}function q(){rt(w.value,d.value)&&(N(),F())}const G=tt(q,200);async function Z(){var a;if(!R)return;await be();const{scrollContainer:t}=n;Ue(t)?d.value=t:Qe(t)&&t!==""?d.value=(a=document.querySelector(t))!=null?a:void 0:w.value&&(d.value=lt(w.value)),d.value&&(c=V(d,"scroll",G),setTimeout(()=>q(),100))}function F(){!R||!d.value||!G||(c==null||c(),d.value=void 0)}function J(a){if(!!a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}function H(){!Y.value||(D=V("wheel",J,{passive:!1}),r=document.body.style.overflow,document.body.style.overflow="hidden",T.value=!0,o("show"))}function K(){D==null||D(),document.body.style.overflow=r,T.value=!1,o("close")}function U(a){o("switch",a)}return ie(()=>n.src,()=>{W.value?(E.value=!0,g.value=!1,F(),Z()):N()}),he(()=>{W.value?Z():N()}),(a,t)=>(I(),S("div",{ref_key:"container",ref:w,class:v([e(C).b(),a.$attrs.class]),style:de(e(P))},[M.value!==void 0&&!g.value?(I(),S("img",Ke({key:0},e(u),{src:M.value,loading:a.loading,style:e(j),class:[e(C).e("inner"),e(Y)&&e(C).e("preview"),E.value&&e(C).is("loading")],onClick:H,onLoad:se,onError:le}),null,16,wt)):_("v-if",!0),E.value||g.value?(I(),S("div",{key:1,class:v(e(C).e("wrapper"))},[E.value?ee(a.$slots,"placeholder",{key:0},()=>[m("div",{class:v(e(C).e("placeholder"))},null,2)]):g.value?ee(a.$slots,"error",{key:1},()=>[m("div",{class:v(e(C).e("error"))},et(e(p)("el.image.error")),3)]):_("v-if",!0)],2)):_("v-if",!0),e(Y)?(I(),S(ce,{key:2},[T.value?(I(),ue(e(mt),{key:0,"z-index":a.zIndex,"initial-index":e(ne),infinite:a.infinite,"url-list":a.previewSrcList,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:K,onSwitch:U},{default:L(()=>[a.$slots.viewer?(I(),S("div",yt,[ee(a.$slots,"viewer")])):_("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):_("v-if",!0)],64)):_("v-if",!0)],6))}}));var kt=ke(ht,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const xt=Ie(kt);export{xt as E};
