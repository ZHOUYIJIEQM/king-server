(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ef86549a","chunk-211cfdb4"],{"02db":function(t,s,i){"use strict";i.r(s);var a=function(){var t=this,s=t._self._c;t._self._setupProxy;return s("div",{ref:"playlistDetailEl",staticClass:"playlist-detail-page"},[s("Navbar",{ref:"navbar",staticClass:"navbar",on:{clickLeft:t.goBack,navbarMounted:t.navbarMounted},scopedSlots:t._u([{key:"left",fn:function(){return[s("div",{staticClass:"icon"},[s("i",{staticClass:"iconfont icon-fanhui"})])]},proxy:!0},{key:"middle",fn:function(){return[s("div",{staticClass:"middle-content"},[s("div",{staticClass:"text"},[s("van-notice-bar",{staticClass:"notice-bar",attrs:{text:t.playListName,speed:"30",color:"#fff",background:"transparent"}})],1),s("i",{staticClass:"iconfont icon-sousuo"})])]},proxy:!0},{key:"right",fn:function(){return[s("i",{staticClass:"iconfont icon-gengduoxiao"})]},proxy:!0},{key:"background",fn:function(){return[s("div",{ref:"navbarBg",staticClass:"navbar-bg bg-outer"},[s("div",{staticClass:"bg-inner",style:{backgroundImage:"url("+t.plBgi+")"}})])]},proxy:!0}])}),s("div",{ref:"playlistDetail",staticClass:"playlist-detail"},[s("div",{staticClass:"description-bg"},[s("div",{ref:"detailBg",staticClass:"detail-bg bg-outer"},[s("div",{staticClass:"bg-inner",style:{backgroundImage:"url("+t.plBgi+")"}})])]),s("div",{ref:"description",staticClass:"description-box",on:{click:t.popUpDetail}},[s("div",{staticClass:"img-box"},[t.playList.coverImgUrl?[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.playList.coverImgUrl,expression:"playList.coverImgUrl"}],attrs:{alt:""}}),s("span",[s("i",{staticClass:"iconfont icon-bofangsanjiaoxing"}),t._v(" "+t._s(t._f("formatNum")(t.playList.playCount)))])]:t._e()],2),t.playList.creator?s("div",{staticClass:"info-box"},[s("div",{staticClass:"playlist-name text-eli"},[t._v(" "+t._s(t.playList.name)+" ")]),s("div",{staticClass:"author"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.playList.creator.avatarUrl,expression:"playList.creator.avatarUrl"}],attrs:{alt:""}}),t._v(" "),s("span",[t._v(t._s(t.playList.creator.nickname))])]),s("div",{staticClass:"playlist-description"},[s("span",{staticClass:"text-eli"},[t._v(t._s(t.playList.description))]),s("i",{staticClass:"iconfont icon-jiantouyou"})])]):t._e()]),s("div",{ref:"playlistBar",staticClass:"playlist-bar"},[s("div",{staticClass:"favo text-eli",class:{"grey-color":t.myPlayList},on:{click:t.handlerSubscribe}},[t.myPlayList||t.subscribed?s("i",{staticClass:"iconfont icon-dagou"}):s("i",{staticClass:"iconfont icon-jia1"}),t.playList.subscribedCount?s("span",{staticClass:"text-eli"},[t._v(t._s(t._f("formatNum")(t.playList.subscribedCount)))]):s("span",[t._v("收藏")])]),s("div",{staticClass:"comment text-eli",on:{click:t.goComment}},[s("i",{staticClass:"iconfont icon-pinglun2"}),t.playList.commentCount?s("span",{staticClass:"text-eli"},[t._v(t._s(t._f("formatNum")(t.playList.commentCount)))]):s("span",[t._v("评论")])]),s("div",{staticClass:"share text-eli",on:{click:function(s){t.showShare=!0}}},[s("i",{staticClass:"iconfont icon-fenxiang"}),t.playList.shareCount?s("span",{staticClass:"text-eli"},[t._v(t._s(t._f("formatNum")(t.playList.shareCount)))]):s("span",[t._v("分享")])])])]),s("div",{ref:"playlist",staticClass:"playlist-song"},[s("van-sticky",{attrs:{"offset-top":t.navbarHeight}},[s("div",{staticClass:"playlist-title"},[s("i",{staticClass:"iconfont icon-bofang1",on:{click:t.playAll}}),s("span",{staticClass:"title-text",on:{click:t.playAll}},[t._v("播放全部"),t.playList.trackIds?s("span",[t._v("("+t._s(t.playList.trackIds.length)+")")]):t._e()]),s("span",{staticClass:"title-icon"},[s("i",{staticClass:"iconfont icon-xiazai1"})])])]),s("van-list",{staticClass:"songlist",attrs:{finished:t.finished,error:t.loadingError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(s){t.loadingError=s},load:t.getSongs},model:{value:t.loadingData,callback:function(s){t.loadingData=s},expression:"loadingData"}},t._l(t.songList,(function(t,i){return s("div",{key:i,staticClass:"list-item"},[s("PlayListDetailItem",{attrs:{listIndex:i+1,listInfo:t}})],1)})),0)],1),s("i",{directives:[{name:"show",rawName:"v-show",value:t.topFlag,expression:"topFlag"}],staticClass:"iconfont icon-fanhui toTop",class:{topMore:t.$store.getters.showPlayer},style:{bottom:t.playListLen&&".6rem"},on:{click:t.toTop}}),s("van-share-sheet",{attrs:{options:t.options},on:{select:t.onSelect},model:{value:t.showShare,callback:function(s){t.showShare=s},expression:"showShare"}}),s("transition",{attrs:{name:"fadeIn"}},[t.playList.id&&t.popUpShow?s("div",{staticClass:"pop-up",on:{click:t.clickPopUp}},[s("i",{staticClass:"iconfont icon-chacha"}),s("div",{staticClass:"inner-box"},[s("div",{staticClass:"top"},[s("div",{staticClass:"img"},[s("img",{attrs:{src:t.playList.coverImgUrl,alt:""}})]),s("div",{staticClass:"name"},[t._v(t._s(t.playList.name))]),s("div",{staticClass:"des-tagbox"},[s("span",[t._v("标签:")]),t._l(t.playList.tags,(function(i,a){return s("div",{key:a,staticClass:"des-tag"},[t._v(" "+t._s(i)+" ")])}))],2),s("div",{staticClass:"des-content",domProps:{innerHTML:t._s(t.description)}})]),s("div",{staticClass:"bottom"},[s("span",{on:{click:function(s){return s.stopPropagation(),t.downloadImg(t.playList.coverImgUrl)}}},[t._v("保存封面")])])]),s("div",{staticClass:"popup-bg bg-outer"},[s("div",{staticClass:"bg-inner",style:{"background-image":"url("+t.playList.coverImgUrl+")"}})])]):t._e()])],1)},e=[],l=(i("14d9"),i("4ec3")),o=i("5a84"),n=i("8610"),r=i("d178"),c=i("bc3a"),h=i.n(c),p={name:"PlayListDetailInclude",mixins:[o["a"]],components:{PlayListDetailItem:n["a"],Navbar:r["default"]},data(){return{plId:0,playListName:"歌单",songsIds:[],songList:[],playList:{},len:100,loadingError:!1,loadingData:!0,finished:!1,scrollTimer:null,navbarHeight:0,topFlag:!1,greyColor:!1,popUpShow:!1,showShare:!1,options:[[{name:"微信",icon:"wechat"},{name:"朋友圈",icon:"wechat-moments"},{name:"微博",icon:"weibo"},{name:"QQ",icon:"qq"},{name:"分享海报",icon:"poster"},{name:"小程序码",icon:"weapp-qrcode"}],[{name:"复制链接",icon:"link"},{name:"二维码",icon:"qrcode"}]],isTouch:!1,scrollHeight:0}},computed:{subscribed(){return!!this.loginStatus&&this.playList.subscribed},myPlayList(){return!!this.loginStatus&&(this.playList.creator&&this.playList.creator.userId===this.$store.getters.userInfo.userId)},description(){return this.playList.description&&this.playList.description.replace(/\n/g,"<br>")},playListLen(){return this.$store.getters.playList.length},plBgi(){return this.playList.coverImgUrl?this.playList.coverImgUrl:""}},mounted(){this.getNavbarHeight(),this.getEleAttr(),window.addEventListener("scroll",this.handlerScroll),this.$refs.playlistDetailEl.addEventListener("touchstart",this.touchS),this.$refs.playlistDetailEl.addEventListener("touchend",this.touchE)},activated(){this.plId=this.$route.params.id,setTimeout(()=>{window.scroll(0,this.scrollHeight),this.handlerScroll(),window.addEventListener("scroll",this.handlerScroll)},10)},deactivated(){window.removeEventListener("scroll",this.handlerScroll)},methods:{async initData(t){try{this.playList={},this.songList=[],this.songsIds=[],this.playListName="",this.finished=!1,this.loadingData=!0;let s=await Object(l["y"])(t);this.playList=s.playlist,this.songsIds=this.playList.trackIds.map(t=>t.id),this.loadingData=!1}catch(s){console.log(s)}},async getSongs(){try{let t=this.songsIds.slice(this.songList.length,this.songList.length+this.len).join(","),s=await Object(l["C"])(t);this.songList.push(...s.songs.map((t,i)=>({id:t.id,name:t.name,secName:t.tns?t.tns[0]:t.alia[0],artist:t.ar.map(t=>t.name).join("/"),al:t.al.name,mvId:t.mv,duration:t.dt/1e3,bgImg:t.al.picUrl+"?param=400y400",sq:s.privileges[i].maxbr>=999e3}))),this.loadingData=!1,this.songList.length>=this.songsIds.length&&(this.finished=!0)}catch(t){console.log(t),this.loadingError=!0}},getEleAttr(){this.navEle=this.$refs.navbar.$el,this.navBgEle=this.$refs.navbarBg,this.descriptionEle=this.$refs.description,this.detailBgEle=this.$refs.detailBg,this.playlistBarEle=this.$refs.playlistBar,this.playlistEle=this.$refs.playlist,this.navH=this.navEle.offsetHeight,this.navbarHeight=this.navH+"px",this.playlistBarT=this.playlistBarEle.getBoundingClientRect().top,this.playlistT=this.playlistEle.getBoundingClientRect().top},handlerScroll(t){if(this.scrollT=Math.ceil(this.getScrollTop()),this.scrollHeight=this.scrollT,this.scrollT>3*this.playlistT?this.topFlag=!0:this.topFlag=!1,this.scrollT<=this.playlistT-this.navH){let t=+(this.scrollT/(this.playlistT-this.navH)).toFixed(2);t=t>=1?1:t,this.navBgEle.style.opacity=t;let s=50-18*t;this.detailBgEle.style.borderRadius=`0 0 ${s}% ${s}%`}else this.navBgEle.style.opacity=1;if(this.scrollT<=this.playlistT){if(this.scrollT>=0&&this.scrollT<=this.navH&&(this.playListName="歌单",this.descriptionEle.style.opacity=1),this.scrollT>=this.navH&&this.scrollT<=this.playlistT-this.navH){this.playListName=this.playList.name;let t=+((this.scrollT-this.navH)/this.descriptionEle.offsetHeight).toFixed(2);t=t>=1?1:t,this.descriptionEle.style.opacity=1-t}if(this.scrollT>=this.playlistBarT-1.5*this.navH&&this.scrollT<=this.playlistT-this.navH){let t=+(this.scrollT-(this.playlistBarT-1.5*this.navH))/(this.playlistT-(this.playlistBarT-.5*this.navH)).toFixed(2);t=t>=1?1:t,this.playlistBarEle.style.opacity=1-t}else this.scrollT>this.playlistT-this.navH?this.playlistBarEle.style.opacity=0:this.scrollT<this.playlistBarT-1.5*this.navH&&(this.playlistBarEle.style.opacity=1)}this.isTouch||(this.scrollT=Math.ceil(this.getScrollTop()),this.sTimer&&clearTimeout(this.sTimer),this.sTimer=setTimeout(()=>{this.scrollT>0&&this.scrollT<this.navH&&window.scroll({top:0,behavior:"smooth"}),this.scrollT>this.navH&&this.scrollT<this.playlistT-this.navH&&window.scroll({top:this.playlistT-this.navH,behavior:"smooth"})},100))},touchS(){this.isTouch=!0},touchE(){this.isTouch=!1,this.handlerScroll()},playAll(){this.songList.length?(this.$store.commit("setPlayList",this.songList),this.toast("即将播放歌单中已加载的歌曲!",3e3),this.clickSong(this.songList[0].id)):this.toast("歌曲还未加载完成!")},async handlerSubscribe(){if(this.loginStatus||this.$dialog.confirm({title:"收藏歌单",message:"需要登录才能收藏哦!",confirmButtonText:"确定"}).then(t=>{this.$store.commit("saveRedirect",this.$route.path),this.$router.replace({name:"Login"})}).catch(t=>{console.log("取消",t)}),this.loginStatus&&!this.myPlayList){this.$store.commit("changeLoading",!0);let s=1;s=this.playList.subscribed?2:1;try{let t=await Object(l["b"])({id:this.playList.id,t:s});console.log(t),200===t.code?(this.playList.subscribed=!this.playList.subscribed,1===s?this.playList.subscribedCount++:this.playList.subscribedCount--):this.$toast("收藏错误, 请重试!"),this.$store.commit("changeLoading",!1)}catch(t){this.$toast("收藏错误, 请重试!"),console.log(t)}finally{this.$store.commit("changeLoading",!1)}}},goComment(){this.$router.push({name:"PlayListComment",params:{id:this.plId}})},onSelect(t){this.showShare=!1,"复制链接"===t.name&&this.copyText(window.location.href)},popUpDetail(){this.popUpShow=!0},clickPopUp(){this.popUpShow=!this.popUpShow},async downloadImg(t){this.$toast({message:"开始下载!",position:"bottom"});const s=this.playList.coverImgUrl.split(".").slice(-1)[0],i=`${this.playList.name}.${s}`;let{data:a}=await h()({url:t,responseType:"blob"});const e=URL.createObjectURL(a),l=document.createElement("a");l.href=e,l.download=i,l.click()},navbarMounted(){this.navbarHeight=this.$refs.navbar.$el.offsetHeight+"px"},getNavbarHeight(){this.navbarTimer=setInterval(()=>{let t=this.$refs.navbar;t&&(this.navbarHeight=t.$el.offsetHeight+"px",clearInterval(this.navbarTimer))},100)}},watch:{popUpShow(t){t?(document.querySelector(".playlist-detail-page").style.overflow="hidden",document.querySelector(".playlist-detail-page").style.height=window.innerHeight+"px"):(document.querySelector(".playlist-detail-page").style.overflow="",document.querySelector(".playlist-detail-page").style.height="")},playlistId(t,s){console.log(t,s)},"$route.params.id":{handler:function(t,s){t&&"PlayListDetail"==this.$route.name&&t!=this.plId&&this.initData(t)},immediate:!0},loadingData(t){}},beforeRouteLeave(t,s,i){this.popUpShow?(console.log(this.popUpShow),this.popUpShow=!1,i(!1)):i()}},d=p,u=(i("7da4"),i("2b9d"),i("2877")),g=Object(u["a"])(d,a,e,!1,null,null,null);s["default"]=g.exports},"2b9d":function(t,s,i){"use strict";i("9e6d")},"335f":function(t,s,i){},"5a84":function(t,s,i){"use strict";i.d(s,"a",(function(){return a}));i("14d9"),i("4ec3");let a={data(){return{}},computed:{loginStatus(){return this.$store.getters.loginStatus},playerPlayList(){return this.$store.getters.playList},adoEl(){return this.$store.getters.adoEl},songId(){return this.$store.getters.songId}},methods:{goLogin(){!this.loginStatus&&this.$router.push({name:"Login"})},logout(){this.$store.dispatch("userLogout")},toggleMenu(){this.$store.commit("toggleMenu")},goBack(){let t=this.$store.getters.historyList;t.length>1?this.$router.go(-1):this.$router.push({name:"Find"})},clickMenu(){console.log("点击了菜单")},goSearch(){this.$router.push({name:"Search"})},toTop(){window.scroll({top:0,behavior:"smooth"})},goPlaylist(t){console.log("点击歌单:",t),this.$router.push({name:"PlayListDetail",params:{id:t}})},async clickSong(t){this.$store.commit("changeSongId",String(t));let s=this.$store.getters.historyList;s.length<=1&&!window.location.href.includes("?player=show")&&(window.location.href+="?player=show"),this.$store.commit("changeShowPlayer",!0)},clickMvIcon(t,s="mv"){this.$store.commit("changeMvId",Number(t)),this.$router.push({name:"MvPlayer",params:{id:t},query:{type:s}})},toast(t,s=1500){this.$toast({message:t,className:"playerToast",duration:s,position:"bottom"})},copyText(t){let s=document.createElement("input");s.value=t,s.style.position="absolute",s.style.left="-10000px",s.style.top="-10000px",document.body.appendChild(s),s.select(),document.execCommand("copy"),this.toast("复制成功! 快和小伙伴们分享吧!"),document.body.removeChild(s)},getScrollTop(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},getClientHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0},getScrollHeight(){return document.body.scrollHeight||document.documentElement.scrollHeight}}}},"7da4":function(t,s,i){"use strict";i("335f")},8610:function(t,s,i){"use strict";var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"playlist-detail-item",on:{click:function(s){return t.clickSong(t.listInfo.id)}}},[s("div",{staticClass:"item-top"},[t.listIndex?[t.activeSong?s("i",{staticClass:"list-index iconfont icon-paixingbang"}):s("span",{staticClass:"list-index"},[t._v(t._s(t.listIndex))])]:t._e(),s("div",{staticClass:"song-info"},[s("div",{staticClass:"name text-eli"},[s("span",{staticClass:"main-name",domProps:{innerHTML:t._s(t.listInfo.name)}}),t.listInfo.secName?s("span",{staticClass:"sec-name"},[t._v(" ("+t._s(t.listInfo.secName)+") ")]):t._e()]),s("div",{staticClass:"artist text-eli"},[t.listInfo.sq?s("span",{staticClass:"tag",attrs:{lang:""}},[t._v("SQ")]):t._e(),t.listInfo.artist?s("span",{attrs:{lang:""}},[t._v(t._s(t.listInfo.artist))]):t._e(),t.listInfo.artistHtml?s("span",{attrs:{lang:""},domProps:{innerHTML:t._s(t.listInfo.artistHtml)}}):t._e(),s("span",{staticClass:"split",attrs:{lang:""}},[t._v("-")]),s("span",{attrs:{lang:""},domProps:{innerHTML:t._s(t.listInfo.al)}})])]),t.listInfo.mvId?s("i",{staticClass:"iconfont icon-bofangshu",on:{click:function(s){return s.stopPropagation(),t.clickMvIcon(t.listInfo.mvId)}}}):t._e(),s("i",{staticClass:"iconfont icon-gengduoxiao"})],2),t.listInfo.officialTags&&t.listInfo.officialTags.length?s("div",{staticClass:"item-bottom"},[t._l(t.listInfo.officialTags,(function(i,a){return s("span",{key:a,staticClass:"reason"},[t._v(" "+t._s(i)+" ")])})),s("span",{staticClass:"al",domProps:{innerHTML:t._s(t.listInfo.al)}})],2):t._e()])},e=[],l=i("5a84"),o={props:{listIndex:Number,listInfo:{type:Object,required:!0,default:function(){return{}}}},mixins:[l["a"]],computed:{activeSong(){return this.$store.getters.songId==this.listInfo.id}},methods:{}},n=o,r=(i("ee68"),i("2877")),c=Object(r["a"])(n,a,e,!1,null,"857aede6",null);s["a"]=c.exports},"9e6d":function(t,s,i){},ae8c:function(t,s,i){},c9ec:function(t,s,i){},d178:function(t,s,i){"use strict";i.r(s);var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"navbar-comp"},[s("div",{staticClass:"left",on:{click:function(s){return t.clickItem("left")}}},[t._t("left")],2),s("div",{staticClass:"middle",on:{click:function(s){return t.clickItem("middle")}}},[t._t("middle")],2),s("div",{staticClass:"right",on:{click:function(s){return t.clickItem("right")}}},[t._t("right")],2),s("div",{staticClass:"background"},[t._t("background")],2)])},e=[],l={methods:{clickItem(t){"left"===t&&this.$emit("clickLeft"),"middle"===t&&this.$emit("clickMiddle"),"right"===t&&this.$emit("clickRight")}},mounted(){this.$emit("navbarMounted")}},o=l,n=(i("d714"),i("2877")),r=Object(n["a"])(o,a,e,!1,null,"2ce0cfb9",null);s["default"]=r.exports},d714:function(t,s,i){"use strict";i("ae8c")},ee68:function(t,s,i){"use strict";i("c9ec")}}]);
//# sourceMappingURL=chunk-ef86549a.e8832a54.js.map